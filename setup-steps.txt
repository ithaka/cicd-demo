# Requirements -
# 40gb free space
# homebrew installed
# fork repo (https://github.com/ithaka/cicd-demo), then clone and-
cd cicd-demo

# Install kubectl -
brew install kubectl
# other oses : https://kubernetes.io/docs/tasks/tools/install-kubectl/

# Install minikube -
brew cask install minikube
# others: https://github.com/kubernetes/minikube/releases

#Install virtualbox on mac
brew cask install virtualbox
# others: https://www.virtualbox.org/wiki/Downloads

# if you already had minikube installed with other settings - minikube stop && minikube delete && rm -rf ~/.minikube
minikube config set disk-size 40000MB
# start the cluster. This takes some time,  2-3 minutes
minikube start
# now your cluster should be running
minikube status
minikube dashboard

### do the above asap!!!! ###



# Add admin privileges to default role (not recommended in real life) -
kubectl create clusterrolebinding kube-system-default-superadmin \
  --clusterrole=cluster-admin \
  --serviceaccount=default:default

# Install helm
brew install kubernetes-helm
# instructions for other platforms: https://docs.helm.sh/using_helm/#installing-helm

# Initialize helm
helm init --service-account default --tiller-namespace default
# should see tiller pod now
kubectl get pods
helm repo update

# Install jenkins using a helm chart
helm install --name jenkins stable/jenkins --values jenkins/values.yaml --tiller-namespace=default
# Get the url for jenkins. Username and password is admin
# may need to delete pod once if it dashboard shows 'pod has unbound PersistentVolumeClaims'
minikube service jenkins --url


## IN JENKINS ##

# In main jenkins settings: set executors to something higher than 0
#  add Github personal access token, or else api is limited to 60 requests per hour
# create multibranch pipeline, add branch source (owner ithaka, repository cicd-demo, behaviors just discover branches)
